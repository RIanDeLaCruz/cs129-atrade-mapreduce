<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<link href="bootstrap.min.css" rel=stylesheet> 
		<link href="bootstrap.min.js" rel=stylesheet>
		 
		
		<title>Top 10 Org Posts</title>
		
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		
		<script src="moment.js"></script>
		<script language="javascript" type="text/javascript">
		$( document ).ready(function() {
			<!-- var today = moment().format('MM/DD/YYYY hh:mm:ss'); -->
			<!-- document.getElementById("startdate").value = today;  -->
		});
			function getValueByKey(key, data) {
				var i, len = data.length;
				
				for (i = 0; i < len; i++) {
					if (data[i] && data[i].hasOwnProperty(key)) {
						return data[i][key];
					}
				}
				
				return -1;
			}
			function getResults() {
				var startDate = moment($("#startdate").val()).unix().toString();
				var endDate = moment($("#enddate").val()).unix().toString();
	
				
				
				$.ajax({
					type: "GET",
					url: "http://cs129-server.iandelacruz.me/meta/ateneochemistrysociety,ateneoaeces,AteneoMathematicsSociety,AteneoBOx,CompSAteneo,AteneoLeaPs,Ateneo.MISA",
					data: "",
					dataType: "json",
					contentType: "application/json; charset=utf-8",
					async: true,
					success: OnSuccess,
					error: OnError
				});

				function OnSuccess(data) {
					var i = 0;
					$.each(data, function (key, value){
						var nickname = Object.keys(data)[i];
						$.ajax({
							type: "GET",
							url: "http://cs129-server.iandelacruz.me/object/"+nickname,
							data: "",
							dataType: "json",
							contentType: "application/json; charset=utf-8",
							async: true,
							success: OnSuccessT,
							error: OnErrorT
						});
						
						function OnSuccessT(data){
							var pageName = data.name;
							$.each(value, function(Tkey, Tvalue){
								var dates = new Date(Tvalue.date_posted);
								var parsedDate = dates.toDateString() + ", " + dates.toLocaleTimeString();
								var reactionsTotal =  Object.keys(Tvalue.post_reactions).length;
							
								$("#resultsList").append("<a href='#' class='list-group-item'>" +
									"<div>" +
										"<h3 align='center'>" + pageName + "</h3>" +
										"<p>" +
										"<h5 align='center'>" + parsedDate + "</h5>" +
										"<br>" +
										"<label>" + Tvalue.post_message + "</label>" +
										"<br>" +
										"<h6 >Total Reactions: "+ reactionsTotal + "</h6>" +
										"<p>" +
										"<h6> Total Comments: " + Tvalue.post_comment_total + "</h6>" +
									"</div>" +
								"</a>"
								
								)
							});
						}
						
						function OnErrorT(data) {
							alert("ERROR " + data.error);
						}
					i++;
					});
				}
				
				function OnError(data) {
					alert("ERROR " + data.error);
				}
			}
		</script>

	</head>
	
	<body>
		<div class="panel panel-default panel-primary">
			<div>
				<div class="panel-body">
				<div class="form-group">
					<label for="queryText">Looking for:</label>
					<input type="text" id="queryText" class="form-control" placeholder="Enter keywords"></input>
					<br>
					<label for="startdate">Start Date: </label>
					<input type="datetime-local" id="startdate"></input>
					
					<br>
					<label for="enddate">End Date: </label>
					<input type="datetime-local" id="enddate"></input>
				</div>
				<p>
				<div class="container" style="text-align:center;">
					<button type="button" onclick="getResults()" class="btn btn-primary" align="center" >Search For Top 10 Results</button>
				</div>
			</div>
		</div>
		
		</div>
		
		<div class="list-group" id="resultsList">
			<a href="#" class="list-group-item">
				
			</a>
			
		</div>
	</body>



</html>
